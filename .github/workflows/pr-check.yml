name: PR Checks

on:
    pull_request:
        branches:
            - main
    workflow_dispatch:

permissions:
    contents: read

jobs:
    tests:
        runs-on: ubuntu-latest
        steps:
            - name: Checkout
              uses: actions/checkout@v4

            - name: Set up Flutter
              uses: subosito/flutter-action@v2
              with:
                  channel: stable
                  cache: true

            - name: Install dependencies
              run: flutter pub get

            # Fail only on analyzer errors (warnings/infos are allowed here).
            - name: Analyze (errors only)
              run: flutter analyze --no-fatal-warnings --no-fatal-infos

            - name: Test
              run: flutter test

    lint:
        runs-on: ubuntu-latest
        continue-on-error: true
        steps:
            - name: Checkout
              uses: actions/checkout@v4

            - name: Set up Flutter
              uses: subosito/flutter-action@v2
              with:
                  channel: stable
                  cache: true

            - name: Install dependencies
              run: flutter pub get

            # Strict lint run; surfaces warnings/infos but does not block PR.
            - name: Analyze (strict)
              run: flutter analyze
